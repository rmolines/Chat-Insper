<!doctype html> 
 
<head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.5/css/bootstrap.min.css" integrity="sha384-AysaV+vQoT3kOAXZkl02PThvDr8HYKPZhNT5h/CXfBThSRXQ6jW5DO2ekP5ViFdi" crossorigin="anonymous">
  	<link rel="stylesheet" href="../stylesheets/chat-view.css">
  
  </head>
  <body>
	<script src="https://use.fontawesome.com/45e03a14ce.js"></script>
<div class="main_section">
   <div class="container">
      <div class="chat_container">
         <div class="col-sm-3 chat_sidebar">
    	 <div class="row">
            <div id="custom-search-input">
               <div class="input-group col-md-12">
                  <input type="text" class="  search-query form-control" placeholder="Conversation" />
                  <button class="btn btn-danger" type="button">
                  <span class=" glyphicon glyphicon-search"></span>
                  </button>
               </div>
            </div>
            <div class="dropdown all_conversation">
               <button class="dropdown-toggle" type="button" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
               <i class="fa fa-weixin" aria-hidden="true"></i>
               All Conversations
               <span class="caret pull-right"></span>
               </button>
               <ul class="dropdown-menu" aria-labelledby="dropdownMenu2">
                  <li><a href="#"> All Conversation </a>  <ul class="sub_menu_ list-unstyled">
               </ul>
			   </li>
               </ul>
            </div>
            <div class="member_list">
               <ul class="list-unstyled">
                
               </ul>
            </div></div>
         </div>
         <!--chat_sidebar-->
		 
		 
         <div class="col-sm-9 message_section">
		 <div class="row">
		 <div class="new_message_head">
		 <div class="pull-left"><button><i class="fa fa-plus-square-o" aria-hidden="true"></i> New Message</button></div>
     <div class="pull-right"><div class="dropdown"><button class="dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    <i class="fa fa-cogs" aria-hidden="true"></i>  Setting
    <span class="caret"></span>
  </button>
  <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenu1">
    <li><a href="#">Action</a></li>
    <li><a href="#">Profile</a></li>
    <li><a href="#">Logout</a></li>
  </ul>
</div></div>
		 </div><!--new_message_head-->
		 
		 <div class="chat_area">
		 <ul id="messages" class="list-unstyled">
		 <li class="left clearfix"><span class="chat-img1 pull-left"></span><div class="chat-body1 clearfix"><p>
                          Hey</p>
                     </div>
                  </li>
				   <li class="left clearfix">
                     <span class="chat-img1 pull-left">
                     </span>
                     <div class="chat-body1 clearfix">
                        <p>Hey, whastup?</p>
						<div class="chat_time pull-right">09:40PM</div>
                     </div>
                  </li>
                     <li class="left clearfix">
                     <span class="chat-img1 pull-left">
                     </span>
                     <div id="div1" class="chat-body1 clearfix">
                         <p>Nm hbu?</p>
    					<div class="chat_time pull-right">09:40PM</div>
                     </div>
                  </li>	  
				
		 
		 
		 </ul>
		 </div><!--chat_area-->
          <div class="message_write">
        	 <textarea id="m" class="form-control" placeholder="type a message"></textarea>
		 <div class="clearfix"></div>
      <a class="pull-right btn btn-success" onclick="sendMessage()">Send</a></div>
		 </div>
		 </div>
         </div> <!--message_section-->
      </div>
   </div>
</div>
    <!-- jQuery first, then Tether, then Bootstrap JS. -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha384-3ceskX3iaEnIogmQchP8opvBy3Mi7Ce34nWjpBIwVTHfGYWQS9jwHDVRnpKKHJg7" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.7/js/tether.min.js" integrity="sha384-XTs3FgkjiBgo8qjEjBk0tGmf3wPrWtA6coPfQDfFEY8AnYJwjalXCiosYRBIBZX8" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.5/js/bootstrap.min.js" integrity="sha384-BLiI7JTZm+JWlgKa0M0kGRpJbF2J8q+qreVrKBC47e3K6BW78kGLrCkeRX6I9RoK" crossorigin="anonymous"></script>
    <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <script>
	  var socket = io();
        var user;

        socket.on('userSet', function(data){
            user = data.username;
            socket.emit('newUser', data.username);
          });

      function sendMessage(){
            var msg = document.getElementById('m').value;
            if(msg){
                socket.emit('msg', {message: msg, user: user});
                $('#m').val('');
            };
        };
        
        socket.emit('user-request');

        socket.on('userId', function(user){
          socket.emit('newUser', {
            user: user,
            id: socket.id
          });
        });

        socket.on('newmsg', function(data){
            var minutes = 1000 * 60;
            var hours = minutes * 60;
            var days = hours * 24;
            var years = days * 365;
            var d = new Date();
            var t = d.getTime();

  
            function msToTime(s) {
              var ms = s % 1000;
              s = (s - ms) / 1000;
              var secs = s % 60;
              s = (s - secs) / 60;
              var mins = s % 60;
              var hrs = (s - mins) / 60;

              return hrs + ':' + mins;
            }

            var y = Math.round(t / msToTime(d));

            var divmsg = "<li class=' left clearfix'><div class='chat-body1 clearfix'><p>";
            var div1 = $(divmsg + data.user + " says: " + data.message + "</p></div></li>");
                if(true){
                $('#messages').append($(div1));

        }
        });
    </script>
  </body>
</html>